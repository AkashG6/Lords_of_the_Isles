<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
</head>
<body>

	<center>
		<button id="roll">Roll Dice</button>
	</center>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>


<script type="text/javascript">

	var islands = ["Greenland","New Guinea","Borneo","Madagascar","Baffin Island","Sumatra","Honshu","Victoria Island","Great Britain","Ellesmere Island","Sulawesi","South Island","Java","North Island","Luzon","Newfoundland","Cuba","Iceland"];

	var resources = ["copper","iron","bronze","wood","oil","coal","uranium","lead","aluminium","diamond","emerald","coconut","salt","rice","wheat"];
	
	$(document).ready(function(){

		function prev_pos(){

			$.ajax({
             type: 'GET',
             url: '/prev_pos',
             success: function(resp){

             	var x = Number(resp[0].xpos);
             	var y = Number(resp[0].ypos);

             	console.log('x='+x+"\ny="+y);
             	
             	if(x<1000){
					var randx = Math.floor(Math.random()*200)+50;
					console.log(randx);
					var px = x;
					var py = y;
					x+=randx;

					update_map(px,x,py,y);
             	}

             	else{
             		var randy = Math.floor(Math.random()*200)+50;
             		var py = y;
             		var px = x;
             		x=10;
             		y+=randy;

             		update_map(px,x,py,y);
             	}
             }
         
            });
		}

		function update_map(pxpos,xpos,pypos,ypos){
			
			$.ajax({
             type: 'POST',
             url: '/update_map',
             data: {pxpos:pxpos ,xpos:xpos, pypos:pypos, ypos:ypos},
             dataType : 'json',
             success: function(resp){
             	console.log(resp.msg);

             	if(resp.msg==="success")
             	assign_values(xpos,ypos);
             }
         
            });
		}

		function assign_values(xpos,ypos){
			var random_name = Math.floor(Math.random()*(islands.length-1));
			var island_name = islands[random_name];

			var random_res = Math.floor(Math.random()*(resources.length-1));
			var res_name = resources[random_res];

			var random_cap = Math.floor(Math.random()*1000) + 30;

			create_island(xpos, ypos, island_name, res_name, random_cap);
				
		}

		function create_island(xpos,ypos,name,resource,cap){

			$.ajax({
                type: 'POST',
                url: '/island_info',
                data: { xpos:xpos, ypos:ypos, name:name , resource:resource, cap:cap },
                dataType: 'json',
         		success: function(resp){

         			if(resp.msg==="near")
         				assign_pos(name, resource, cap);

         			else if(resp.msg==="owned")
         				alert("Owned island: "+name);

         			else if(resp.msg==="new")
         				alert("New island: "+name+"\nXpos: "+xpos+"\nYpos: "+ypos+"\nInitial Resource: "+resource+"\nPopulation Cap: "+cap);
         		}
            });
		}

		$("#roll").click(function(){
			prev_pos();
		});
	});

</script>

</body>
</html>